---
import SectionHeader from "../ui/SectionHeader.astro";
import Button from "../ui/Button.astro";
const heading = "Testimonials";
const subHeading =
  "Hear from Our Satisfied Clients: Read Our Testimonials to Learn More about Our Digital Marketing Services";

const testimonials = [
  {
    id: 1,
    text: "We have been working with Positivus for the past year and have seen a significant increase in website traffic and leads as a result of their efforts. The team is professional, responsive, and truly cares about the success of our business. We highly recommend Positivus to any company looking to grow their online presence.",
    name: "John Smith",
    position: "Marketing Director at XYZ Corp"
  },
  {
    id: 2,
    text: "We have been working with Positivus for the past year and have seen a significant increase in website traffic and leads as a result of their efforts. The team is professional, responsive, and truly cares about the success of our business. We highly recommend Positivus to any company looking to grow their online presence.",
    name: "Jane Doe",
    position: "CEO at ABC Company"
  },
  {
    id: 3,
    text: "We have been working with Positivus for the past year and have seen a significant increase in website traffic and leads as a result of their efforts. The team is professional, responsive, and truly cares about the success of our business. We highly recommend Positivus to any company looking to grow their online presence.",
    name: "Mike Johnson",
    position: "Marketing Director at DEF Corp"
  },
  {
    id: 4,
    text: "We have been working with Positivus for the past year and have seen a significant increase in website traffic and leads as a result of their efforts. The team is professional, responsive, and truly cares about the success of our business. We highly recommend Positivus to any company looking to grow their online presence.",
    name: "Sarah Williams",
    position: "Director at GHI Inc"
  },
  {
    id: 5,
    text: "We have been working with Positivus for the past year and have seen a significant increase in website traffic and leads as a result of their efforts. The team is professional, responsive, and truly cares about the success of our business. We highly recommend Positivus to any company looking to grow their online presence.",
    name: "Tom Brown",
    position: "Manager at JKL Ltd"
  }
];
---

<div class="h-auto mt-[3rem] w-full flex justify-center items-center">
  <div
    class="w-[88%] h-full flex flex-col items-center justify-center max-lg:gap-[1rem] rounded-t-3xl"
  >
    <SectionHeader heading={heading} subHeading={subHeading} />

    <!-- Testimonials Container -->
    <div class="w-full bg-[#191A23] rounded-3xl mt-[3rem] px-12 py-16">
      <!-- Testimonials Slider -->
      <div class="overflow-hidden">
      <div id="testimonials-track" class="flex gap-8 transition-transform duration-500 ease-in-out">
        {testimonials.map((testimonial) => (
          <div class="min-w-[calc(50.333%-1.5rem)] flex flex-col">
            <!-- Speech Bubble -->
            <div class="bg-[#191A23] border-2 border-heyOzGreen rounded-3xl p-8 relative">
              <p class="text-white leading-relaxed">
                "{testimonial.text}"
              </p>
              <!-- Arrow pointing down -->
              <div class="absolute -bottom-4 left-12 w-8 h-8 bg-[#191A23] border-b-2 border-r-2 border-heyOzGreen rotate-45"></div>
            </div>

            <!-- Author Info -->
            <div class="mt-8 ml-4">
              <p class="text-heyOzGreen font-medium text-lg">{testimonial.name}</p>
              <p class="text-white text-sm">{testimonial.position}</p>
            </div>
          </div>
        ))}
      </div>
      </div>

      <!-- Navigation Controls -->
      <div class="flex justify-center items-center gap-8 mt-12">
        <!-- Left Arrow -->
        <button id="prev-btn" class="text-white hover:text-heyOzGreen transition-colors" aria-label="Previous testimonial">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>

        <!-- Dots Indicator -->
        <div class="flex gap-3" id="dots-container">
          {testimonials.map((_, index) => (
            <button 
              class="indicator-dot transition-opacity hover:opacity-80" 
              data-index={index}
              aria-label={`Go to slide ${index + 1}`}
            >
              <img 
                src={index === 0 ? "/Vector-green.png" : "/Vector-white.png"} 
                alt="" 
                class="w-3 h-3"
              />
            </button>
          ))}
        </div>

        <!-- Right Arrow -->
        <button id="next-btn" class="text-white hover:text-heyOzGreen transition-colors" aria-label="Next testimonial">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  let currentIndex = 0;
  const testimonials = document.querySelectorAll('#testimonials-track > div');
  const totalSlides = testimonials.length;
  const track = document.getElementById('testimonials-track');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const dots = document.querySelectorAll('.indicator-dot');

  function updateSlider() {
    // Calculate the transform value (showing 2 testimonials at a time)
    const translateX = -currentIndex * (50 + 2); // 50% width + 2% gap
    if (track) {
      track.style.transform = `translateX(${translateX}%)`;
    }

    // Update dots
    dots.forEach((dot, index) => {
      const img = dot.querySelector('img');
      if (img) {
        if (index === currentIndex) {
          img.src = '/Vector-green.png';
        } else {
          img.src = '/Vector-white.png';
        }
      }
    });
  }

  function nextSlide() {
    currentIndex = (currentIndex + 1) % totalSlides;
    updateSlider();
  }

  function prevSlide() {
    currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
    updateSlider();
  }

  // Event listeners
  nextBtn?.addEventListener('click', nextSlide);
  prevBtn?.addEventListener('click', prevSlide);

  dots.forEach((dot) => {
    dot.addEventListener('click', () => {
      currentIndex = parseInt(dot.getAttribute('data-index') || '0');
      updateSlider();
    });
  });

  // Optional: Auto-play
  // setInterval(nextSlide, 5000);
</script>